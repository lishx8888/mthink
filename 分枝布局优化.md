# 思维导图分枝布局优化算法

## 核心思想
实现输入内容时实时调整相邻分枝的间距，确保思维导图在编辑过程中保持良好的布局和可读性。

## 算法原理

### 1. 分枝方向判断
- 分枝是逐级向根节点的
- 首先判断分枝在中央分枝的上面还是下面
- 基于上级节点的分枝数量进行编号和判断

### 2. 分枝分类方法
1. **编号规则**：对上级节点的所有分枝从上到下进行编号
2. **均值计算**：计算分枝编号的均值
   - 例如：有9个分枝，编号为1-9，均值为5
3. **分类标准**：
   - 编号小于均值的为上分枝
   - 编号大于均值的为下分枝
   - 编号等于均值的为中分枝（只在奇数个分枝时出现）

### 3. 宽度变化处理策略

#### 中分枝宽度变化
- 往上下两边推开其它分枝
- 保持中分枝的中心位置不变

#### 上分枝宽度变化
- 往上推开上面的分枝
- 不影响下面的分枝位置

#### 下分枝宽度变化
- 往下推开下面的分枝
- 不影响上面的分枝位置

## 实现步骤

### 1. 实时监测
- 监听节点文本输入事件
- 监测节点宽度变化

### 2. 分枝关系分析
- 确定当前节点所属的分枝
- 分析上级节点的分枝数量和编号
- 计算均值并确定当前分枝类型（上/中/下）

### 3. 间距调整
- 根据分枝类型执行相应的间距调整策略
- 计算需要调整的距离
- 递归调整相关分枝的位置

### 4. 布局更新
- 实时更新思维导图布局
- 确保所有节点位置正确

## 优势

1. **实时响应**：输入内容时立即调整布局
2. **智能分配**：根据分枝位置采取不同的调整策略
3. **视觉平衡**：保持思维导图的整体平衡和美观
4. **用户友好**：编辑过程中不会出现节点重叠或拥挤的情况

## 应用场景

- 思维导图节点文本编辑
- 节点样式调整
- 分枝结构变化
- 大规模思维导图的布局优化

## 实现建议

1. 使用防抖机制优化实时布局性能
2. 采用递归算法处理多层级分枝调整
3. 维护分枝关系数据结构，提高查询效率
4. 结合动画效果，提升用户体验

## 代码实现参考

```javascript
// 伪代码示例
function adjustBranchSpacing(node) {
  // 1. 分析分枝关系
  const parent = node.parent;
  const branches = parent.children;
  const branchIndex = branches.indexOf(node);
  const branchCount = branches.length;
  const meanValue = Math.ceil(branchCount / 2);
  
  // 2. 确定分枝类型
  let branchType;
  if (branchIndex < meanValue - 1) {
    branchType = 'upper';
  } else if (branchIndex > meanValue - 1) {
    branchType = 'lower';
  } else {
    branchType = 'middle';
  }
  
  // 3. 执行调整策略
  switch (branchType) {
    case 'upper':
      // 往上调整上面的分枝
      adjustUpperBranches(node, branchIndex);
      break;
    case 'lower':
      // 往下调整下面的分枝
      adjustLowerBranches(node, branchIndex);
      break;
    case 'middle':
      // 往上下两边调整
      adjustMiddleBranch(node);
      break;
  }
  
  // 4. 递归处理上级分枝
  if (parent !== rootNode) {
    adjustBranchSpacing(parent);
  }
}
```

## 性能优化

1. **计算缓存**：缓存已计算的分枝关系和位置
2. **增量调整**：只调整受影响的分枝
3. **批量更新**：合并多次调整操作，减少重绘次数
4. **自适应触发**：根据节点大小变化程度决定是否触发调整

此算法可以显著提升思维导图的编辑体验，确保在输入和编辑过程中始终保持良好的布局效果。