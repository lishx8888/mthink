# mthink

一个功能完善的思维导图工具，支持创建、编辑、保存和加载思维导图，具备强大的自动布局功能。

## 功能特性

### 核心功能
- 创建和编辑思维导图节点
- 支持节点颜色自定义
- 支持添加、删除和编辑节点内容
- 支持保存思维导图（JSON格式）
- 支持导出思维导图（SVG、PNG、Markdown格式）
- 支持导入思维导图（JSON格式）
- 响应式设计，适配不同屏幕尺寸

### 优化功能
- **节点编号系统**：为每个节点自动生成唯一编号，支持正向（1, 2, 3...）和反向（-1, -2, -3...）编号
- **智能自动布局**：基于节点编号实现稳定的自动布局，一次点击即可达到预期效果
- **坐标系统优化**：将(0,0)点从页面左上角移到页面中央，更符合使用习惯
- **节点内容与编号分离**：节点编号和文字内容独立存储，避免相互干扰
- **改进的保存/加载**：确保节点编号和文字内容在保存和导入过程中不丢失
- **水平节点间距优化**：确保正向布局中节点不重叠，保持相邻节点边的108px间距
- **文本溢出处理**：实现文本自动换行逻辑和CSS clip-path，确保文本不会超出节点框
- **端点位置固定**：编辑节点文本后，节点的端点位置保持固定
- **节点对齐优化**：使用第一个节点的端点位置作为基准，确保所有子节点左端点对齐，所有父节点右端点对齐
- **根节点位置固定**：确保根节点固定在中心(0,0)，包括编辑文本时
- **默认节点宽度**：所有节点默认宽度为400px，保持一致性
- **编辑模式优化**：编辑节点文本时，节点高度根据内容自动调整
- **多选节点样式设置**：选择多个节点时，只修改用户实际调整的样式属性，保持其他属性不变
- **连接线颜色保存**：确保连接线颜色在保存和加载过程中不丢失，保持视觉一致性
- **SVG/PNG导出优化**：确保导出的文件中文本与编辑界面保持一致的左对齐样式，避免文本变成单行显示
- **中心节点标识**：为中心节点添加isCenterNode属性，明确标识初始节点或中心节点，方便后续优化
- **撤销操作修复**：修复撤销操作后节点不立即消失、需要撤销两次的问题，确保撤销操作流畅
- **导入文件处理**：优化导入JSON文件的处理，确保即使缺少isCenterNode属性也能正确识别中心节点
- **多个中心节点处理**：当导入的文件中存在多个nodeNumber为"0"的节点时，自动处理冲突，确保只有一个中心节点

## 使用方法

### 基本操作
1. 打开 `index.html` 文件
2. 点击画布创建中心节点
3. 点击节点上的"添加子节点"按钮添加正向思维节点（右侧）
4. 点击节点上的"添加父节点"按钮添加反向思维节点（左侧）
5. 点击节点可编辑内容
6. 使用侧边栏的颜色选择器更改节点颜色
7. 使用**保存**按钮保存思维导图（JSON格式）
8. 使用**加载**按钮加载思维导图（JSON格式）
9. 使用**导出**按钮导出思维导图为其他格式（SVG、PNG、Markdown）

### 自动布局功能
1. 点击"自动布局"按钮，系统会自动为所有节点分配位置
2. 自动布局会基于节点编号进行排序和定位
3. 系统会为没有编号的节点自动生成合理的编号
4. 一次点击即可达到稳定的布局效果

### 节点编号规则
- **中心节点**：编号为 "0"
- **正向思维节点**（右侧）：按层级编号为 1, 2, 3, 21, 22, 23, 221, 222...
- **反向思维节点**（左侧）：按层级编号为 -1, -2, -3, -21, -22, -23, -221, -222...
- 节点编号会在自动布局时自动生成和更新

## 技术栈

- HTML5
- CSS3
- JavaScript (ES6+)
- SVG

## 项目结构

```
mthink/
├── index.html    # 主页面
├── style.css     # 样式文件
├── script.js     # 主要逻辑
├── server.js     # 本地服务器
└── README.md     # 项目说明
```

## 开发说明

### 启动本地服务器

```bash
node server.js
```

然后在浏览器中访问 `http://localhost:8000`

### 功能实现

- **节点创建与编辑**: 支持点击创建节点，双击编辑内容
- **节点连接**: 自动绘制节点之间的连接线
- **SVG导入/导出**: 支持将思维导图导出为SVG格式，并可导入外部SVG思维导图
- **响应式设计**: 适配桌面和移动设备
- **自定义保存对话框**: 提供美观的自定义保存对话框

## 未来计划

- **思维导图合并**：实现两个思维导图的合并功能，基于isCenterNode属性识别中心节点
- **实时协作**：添加多人实时协作编辑功能
- **更多导出格式**：支持导出为PDF、Word等更多格式
- **模板系统**：提供思维导图模板，方便快速创建特定类型的思维导图
- **高级样式定制**：支持更丰富的节点样式定制，如边框样式、阴影效果等
- **搜索功能**：添加节点内容搜索功能，快速定位相关节点

## 许可证

MIT License
