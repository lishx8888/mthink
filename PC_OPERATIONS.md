# 思维导图应用 PC端功能与操作总结

## 1. 整体界面布局

### 1.1 主要区域
- **SVG画布区域**：占据页面主要空间，用于显示和编辑思维导图
- **样式面板**：位于右侧，宽度250px，包含保存/加载按钮和样式设置选项
- **保存对话框**：点击保存按钮后弹出的模态窗口，支持选择保存格式和文件名

### 1.2 界面元素
- **节点**：思维导图的基本单位，包含文本内容和操作按钮
- **连接线**：连接父节点和子节点的线条
- **半圆按钮**：节点两侧的半圆区域，用于添加子节点
- **样式控件**：颜色选择器、输入框、下拉菜单等样式设置工具

## 2. 核心功能

### 2.1 思维导图创建与编辑
- **创建中心节点**：点击画布空白区域创建中心节点
- **添加子节点**：点击节点左侧或右侧的半圆按钮添加子节点
- **编辑节点内容**：双击节点文本区域进入编辑模式
- **删除节点**：删除节点及其所有子节点（需进一步确认具体操作）
- **拖拽移动节点**：点击节点并拖动调整位置
- **框选多个节点**：在画布上拖动鼠标创建选择框，选中多个节点

### 2.2 节点样式定制
- **节点颜色**：通过颜色选择器自定义节点背景色
- **边框颜色**：自定义节点边框颜色
- **字体颜色**：自定义节点文本颜色
- **字体大小和类型**：调整节点文本的字体大小和字体类型

### 2.3 保存与加载
- **保存格式支持**：
  - JSON格式：保存思维导图的结构化数据
  - SVG格式：保存矢量图形格式
  - PNG格式：保存图片格式
  - Markdown格式：保存为Markdown文本
- **文件命名**：支持自定义保存文件名
- **加载功能**：从本地文件系统加载已保存的思维导图

### 2.4 画布操作
- **画布平移**：按住Ctrl键并拖动鼠标，平移整个画布
- **对齐和间距提示**：节点拖动时显示对齐辅助线和间距提示
- **缩略图画布**：提供思维导图的缩略图视图，方便导航

### 2.5 高级功能
- **折叠/展开节点**：支持折叠或展开节点的子树
- **反向连接**：支持创建反向连接关系
- **操作历史记录**：记录用户操作，支持撤销/重做
- **自动布局**：基于节点编号的智能自动布局功能，一次点击即可达到稳定的布局效果
- **节点编号系统**：自动为节点生成唯一编号，支持正向（右侧）和反向（左侧）节点编号
- **水平节点间距优化**：确保正向布局中节点不重叠，保持相邻节点边的108px间距
- **文本溢出处理**：实现文本自动换行逻辑和CSS clip-path，确保文本不会超出节点框
- **端点位置固定**：编辑节点文本后，节点的端点位置保持固定
- **节点对齐优化**：使用第一个节点的端点位置作为基准，确保所有子节点左端点对齐，所有父节点右端点对齐
- **根节点位置固定**：确保根节点固定在中心(0,0)，包括编辑文本时
- **默认节点宽度**：所有节点默认宽度为400px，保持一致性
- **编辑模式优化**：编辑节点文本时，节点高度根据内容自动调整
- **多选节点样式设置**：选择多个节点时，只修改用户实际调整的样式属性，保持其他属性不变
- **连接线颜色保存**：确保连接线颜色在保存和加载过程中不丢失，保持视觉一致性
- **SVG/PNG导出优化**：确保导出的文件中文本与编辑界面保持一致的左对齐样式，避免文本变成单行显示

### 2.6 节点编号系统
- **中心节点**：编号为 "0"
- **正向思维节点**（右侧）：按层级编号为 1, 2, 3, 2.1, 2.2, 2.3, 2.2.1, 2.2.2...
- **反向思维节点**（左侧）：按层级编号为 -1, -2, -3, -2.1, -2.2, -2.3, -2.2.1, -2.2.2...
- 自动生成：在自动布局时自动为无编号节点生成合理的编号
- 独立存储：节点编号与文字内容分离，避免相互干扰

## 3. PC端操作方式

### 3.1 鼠标操作
- **左键单击**：
  - 画布空白处：创建中心节点
  - 节点：选择节点
  - 半圆按钮：添加子节点
  - 样式控件：选择样式选项
  - 自动布局按钮：应用智能自动布局
- **双击**：
  - 节点文本：编辑节点内容
- **拖拽**：
  - 节点：移动节点位置
  - 画布空白处（无Ctrl键）：框选多个节点
  - 画布空白处（按住Ctrl键）：平移画布
- **悬停**：
  - 节点：显示悬停效果
  - 半圆按钮：显示添加子节点提示

### 3.3 自动布局操作
- **应用自动布局**：点击"自动布局"按钮，系统会自动为所有节点分配位置
- **自动编号生成**：自动布局时会为没有编号的节点生成合理的编号
- **布局稳定性**：一次点击即可达到稳定的布局效果
- **布局规则**：基于节点编号进行排序和定位，确保布局的合理性和美观性

### 3.2 键盘操作
- **Enter键**：确认节点编辑
- **Escape键**：取消节点编辑
- **Ctrl键**：与鼠标配合使用，实现画布平移

## 4. 技术实现要点

### 4.1 核心技术栈
- HTML5 + CSS3 + JavaScript (ES6+)
- SVG：用于绘制思维导图图形
- 响应式设计：适配不同屏幕尺寸

### 4.2 关键实现方式
- **节点管理**：使用Node类管理节点的属性和方法
- **画布渲染**：使用SVG API绘制节点、连接线和辅助线
- **事件处理**：使用鼠标事件实现交互功能
- **数据存储**：使用JSON格式存储思维导图数据

## 5. 移动端优化方向分析

基于PC端的功能和操作方式，移动端优化需要重点关注以下几个方面：

### 5.1 布局调整
- 样式面板从右侧移至底部，节省横向空间
- 画布占满整个屏幕，支持手势操作

### 5.2 交互方式优化
- 触摸事件替代鼠标事件
- 增大触摸目标（按钮、节点等）至推荐的44x44像素
- 长按替代右键点击
- 双指手势替代Ctrl+拖拽

### 5.3 功能适配
- 简化保存/加载流程，适应移动端文件系统
- 优化编辑体验，考虑触摸输入的特点
- 可能需要隐藏或调整部分高级功能

### 5.4 性能优化
- 减少不必要的重绘和重排
- 优化触摸事件处理，减少延迟
- 考虑移动设备的性能限制

## 6. 总结

PC端思维导图应用提供了丰富的功能和灵活的操作方式，支持用户创建、编辑、保存和加载思维导图。移动端优化需要在保持核心功能的同时，调整布局和交互方式，以适应移动设备的特点和用户习惯。