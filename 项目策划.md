# 思维导图项目策划文档

## 1. 项目概述

### 1.1 项目背景
思维导图是一种可视化思维工具，能够帮助用户组织思路、梳理信息、激发创意。本项目旨在开发一个功能完善、易于使用的Web端思维导图应用，支持节点创建、编辑、拖拽、样式设置等核心功能，并提供保存/加载功能。

### 1.2 项目目标
- 开发一个基于Web的思维导图应用
- 实现直观的用户界面和流畅的交互体验
- 支持核心思维导图功能
- 确保应用的稳定性和可扩展性

### 1.3 目标用户
- 学生：用于学习笔记、知识梳理
- 职场人士：用于会议记录、项目规划
- 创意工作者：用于头脑风暴、创意激发

## 2. 功能需求

### 2.1 核心功能

| 功能模块 | 具体功能 | 优先级 |
|---------|---------|-------|
| 节点管理 | 创建节点 | 高 |
| 节点管理 | 删除节点 | 高 |
| 节点管理 | 编辑节点文本 | 高 |
| 节点管理 | 折叠/展开节点 | 中 |
| 拖拽功能 | 节点拖拽移动 | 高 |
| 样式设置 | 节点背景颜色 | 中 |
| 样式设置 | 节点边框颜色 | 中 |
| 样式设置 | 字体颜色 | 中 |
| 样式设置 | 字体大小 | 中 |
| 样式设置 | 字体选择 | 中 |
| 布局功能 | 树叶逻辑（自动布局，避免叶子节点交叉或重叠） | 高 |
| 数据管理 | 保存思维导图 | 高 |
| 数据管理 | 加载思维导图 | 高 |

### 2.2 非功能需求

| 需求类型 | 具体要求 | 优先级 |
|---------|---------|-------|
| 性能 | 响应时间 < 100ms | 高 |
| 可用性 | 界面简洁直观，易于操作 | 高 |
| 兼容性 | 支持主流浏览器（Chrome、Firefox、Safari、Edge） | 高 |
| 可扩展性 | 支持后续功能扩展 | 中 |

### 2.3 树叶逻辑功能详细说明

#### 2.3.1 功能描述
- 自动布局算法，确保思维导图的叶子节点（没有子节点的节点）之间不会发生交叉或重叠
- 保持节点的层级关系和父子连接
- 优化节点间距，确保视觉上的清晰和美观
- 支持动态调整，当添加、删除或移动节点时，自动重新布局以避免叶子节点重叠

#### 2.3.2 实现原理
1. **叶子节点识别**：遍历所有节点，识别出没有子节点的叶子节点
2. **层级分析**：计算每个节点的深度和层级关系
3. **坐标计算**：
   - 从右到左计算叶子节点的Y坐标，确保叶子节点之间保持100像素的垂直间距
   - 父节点的Y坐标基于其子节点的Y坐标计算（奇数个子节点取中间子节点的Y坐标，偶数个子节点取中间两个子节点Y坐标的平均值）
   - 节点的X坐标根据其深度确定，同级节点具有相同的X坐标，与上级节点保持180像素的水平间距
4. **碰撞检测**：在布局过程中检测节点之间的碰撞，调整节点位置以避免重叠

#### 2.3.3 技术要求
- 使用深度优先遍历算法分析节点层级关系
- 实现高效的碰撞检测算法，确保性能
- 支持虚拟叶子节点处理（没有真正叶子节点的非叶子节点）
- 保持节点顺序与原始树结构一致
- 确保Y坐标计算的准确性，避免渲染问题

#### 2.3.4 边界条件
- 处理只有根节点的情况
- 处理所有节点都是叶子节点的情况
- 处理深度超过10级的复杂树结构
- 处理大量叶子节点（超过100个）的性能问题

#### 2.3.5 验收标准
- 叶子节点之间没有交叉或重叠
- 父节点位于其子节点的中间位置（垂直方向）
- 同级节点具有相同的X坐标
- 节点间距符合要求（水平180像素，垂直100像素）
- 节点顺序与原始树结构一致
- 添加、删除或移动节点时，自动重新布局以保持叶子节点不重叠

## 3. 技术架构

### 3.1 技术选型

| 技术类型 | 技术选择 | 理由 |
|---------|---------|-----|
| 前端框架 | 原生JavaScript | 轻量级，无依赖，学习成本低，适合实现复杂的算法逻辑 |
| 渲染技术 | SVG | 矢量图形，缩放不失真，适合绘制思维导图和复杂的节点布局 |
| 样式技术 | CSS3 | 支持丰富的样式效果和响应式设计 |
| 数据存储 | localStorage | 浏览器本地存储，简单易用，适合小型应用 |
| 算法实现 | 深度优先遍历、碰撞检测算法 | 用于分析节点层级关系和避免节点重叠 |

### 3.2 系统架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      用户界面层                                          │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌──────────────┐  ┌─────────┐  │
│  │ 工具栏   │  │ 画布区域 │  │ 节点元素 │  │ 样式设置面板  │  │ 布局控制  │  │
│  └─────────┘  └─────────┘  └─────────┘  └──────────────┘  └─────────┘  │
└───────────────────────────┬───────────────────────────────────────────┘
                            │
┌───────────────────────────▼───────────────────────────────────────────┐
│                      业务逻辑层                                          │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌──────────────┐  ┌─────────┐  │
│  │ 节点管理 │  │ 渲染引擎 │  │ 交互处理 │  │ 数据处理模块  │  │ 布局算法  │  │
│  └─────────┘  └─────────┘  └─────────┘  └──────────────┘  └─────────┘  │
│                            ┌───────────────────────────────────┐      │
│                            │  树叶逻辑实现                       │      │
│                            │  ┌─────────┐  ┌─────────┐  ┌─────┐│      │
│                            │  │ 层级分析 │  │ 坐标计算 │  │碰撞检测││      │
│                            │  └─────────┘  └─────────┘  └─────┘│      │
│                            └───────────────────────────────────┘      │
└─────────────────────────────────┬─────────────────────────────────────┘
                                   │
┌─────────────────────────────────▼─────────────────────────────────────┐
│                      数据层                                           │
│  ┌─────────┐  ┌─────────┐  ┌───────────────────────┐      ┌─────────┐  │
│  │ 节点数据 │  │ 连接数据 │  │ 本地存储（localStorage）│      │ 布局数据 │  │
│  └─────────┘  └─────────┘  └───────────────────────┘      └─────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
```

## 4. 用户界面设计

### 4.1 界面布局

```
┌─────────────────────────────────────────────────────────────────┐
│                         工具栏                                   │
│  [添加节点] [删除节点] [保存] [加载]                              │
├─────────────────────────────────────────────────────────────────┤
│                         主区域                                   │
│  ┌──────────────────────────────────────────────┐  ┌─────────┐ │
│  │                                              │  │ 样式面板 │ │
│  │               SVG画布区域                     │  │         │ │
│  │                                              │  │         │ │
│  │                                              │  │         │ │
│  │                                              │  │         │ │
│  └──────────────────────────────────────────────┘  └─────────┘ │
│                         [缩略图]                                │
└─────────────────────────────────────────────────────────────────┘
```

**注意：** 缩略图固定位于左下角，不可更改位置。

### 4.2 界面元素设计

#### 4.2.1 工具栏
- 按钮：添加节点、删除节点、保存、加载
- 样式：深色背景，白色文字，悬停效果

#### 4.2.2 画布区域
- 背景：白色
- 尺寸：自适应浏览器窗口
- 滚动：支持鼠标滚轮缩放和拖拽平移

#### 4.2.3 节点元素
- 形状：圆角矩形
- 边框：黑色实线
- 填充：白色
- 文本：居中显示
- 选中状态：绿色边框

#### 4.2.4 样式面板
- 位置：右侧固定面板
- 内容：颜色选择器（节点颜色、边框颜色、字体颜色）、数字输入框（字体大小）、下拉选择框（字体）

## 5. 开发计划

### 5.1 开发阶段划分

| 阶段 | 时间 | 任务内容 |
|-----|-----|---------|
| 1. 需求分析与设计 | 1天 | 确定功能需求、技术架构、界面设计 |
| 2. 基础框架搭建 | 1天 | 创建HTML、CSS、JS基础文件结构 |
| 3. 核心功能开发 | 2天 | 实现节点数据结构、渲染引擎、交互功能 |
| 4. 高级功能开发 | 1天 | 实现样式设置、保存/加载功能 |
| 5. 测试与优化 | 1天 | 功能测试、性能优化、兼容性测试 |
| 6. 文档编写 | 1天 | 编写使用文档、技术文档 |

### 5.2 里程碑

- 里程碑1：完成基础框架搭建，能够显示简单的思维导图
- 里程碑2：完成核心功能开发，支持节点的创建、删除、编辑、拖拽
- 里程碑3：完成高级功能开发，支持样式设置和数据存储
- 里程碑4：完成测试与优化，确保应用稳定可用

## 6. 风险评估

| 风险类型 | 具体风险 | 影响程度 | 发生概率 | 应对措施 |
|---------|---------|---------|---------|---------|
| 技术风险 | SVG渲染性能问题 | 中 | 中 | 优化渲染算法，减少重绘次数 |
| 兼容性风险 | 浏览器兼容性问题 | 中 | 高 | 针对主流浏览器进行测试和适配 |
| 功能风险 | 节点拖拽体验不佳 | 中 | 中 | 优化拖拽算法，添加视觉反馈 |
| 数据风险 | 本地存储容量限制 | 低 | 中 | 考虑添加导出为文件功能作为备选方案 |

## 7. 验收标准

### 7.1 功能验收

| 功能 | 验收标准 |
|-----|---------|
| 创建节点 | 点击添加节点按钮，在选中节点下创建新节点 |
| 删除节点 | 点击删除节点按钮，删除选中节点（根节点除外） |
| 编辑节点 | 双击节点，可编辑节点文本 |
| 拖拽节点 | 鼠标拖拽节点，可调整节点位置 |
| 折叠/展开节点 | 点击节点前的折叠/展开图标，可折叠/展开子节点 |
| 样式设置 | 调整样式面板中的选项，节点样式实时更新 |
| 保存功能 | 点击保存按钮，思维导图数据保存到本地 |
| 加载功能 | 点击加载按钮，可加载之前保存的思维导图 |

### 7.2 性能验收

| 指标 | 验收标准 |
|-----|---------|
| 响应时间 | 节点操作响应时间 < 100ms |
| 渲染性能 | 100个节点以内，渲染流畅无明显卡顿 |

### 7.3 兼容性验收

| 浏览器 | 版本 | 验收标准 |
|-------|-----|---------|
| Chrome | 最新版 | 功能正常，界面美观 |
| Firefox | 最新版 | 功能正常，界面美观 |
| Safari | 最新版 | 功能正常，界面美观 |
| Edge | 最新版 | 功能正常，界面美观 |

## 8. 后续扩展计划

1. 支持导出为图片（PNG、JPEG）和PDF格式
2. 支持多人协作编辑
3. 添加更多节点样式模板
4. 支持快捷键操作
5. 实现思维导图模板功能
6. 添加搜索和筛选功能
7. 支持导入其他思维导图格式文件